language: d

# latest dmd, gdc and ldc
# ldc fails; built with cmake -DBUILD_SHARED_LIBS=ON ? if yes, ld doesn't find them or names are wrong; "dflags-posix-ldc": ["-defaultlib=:libphobos2-ldc.so,:libdruntime-ldc.so"]
# gdc:
d:
  - dmd
  - gdc

dist: trusty
sudo: required

# opensc-pkcs11 is required for libopensc.so(.*), opensc seems to be optional if no tools/opensc.conf/profile used
before_install:
  - sudo add-apt-repository -y ppa:gertvdijk/opensc-backports
  - sudo apt-get update -y -qq
  - sudo apt-get install -y opensc-pkcs11 opensc
  - sudo ln -s -T /usr/lib/x86_64-linux-gnu/libopensc.so.4.0.0 /usr/lib/libopensc.so
  - sudo ldconfig
# - sudo apt-get install -y pkg-config openssl libssl-dev libpcsclite-dev libltdl-dev libreadline-dev
#before_install:
#  - sudo apt-get install -y pcscd libccid libpcsclite-dev libssl-dev libltdl-dev libreadline-dev autoconf automake build-essential docbook-xsl xsltproc libtool pkg-config openssl
#install:
#  - wget https://sourceforge.net/projects/opensc/files/OpenSC/opensc-0.16.0/opensc-0.16.0.tar.gz
#  - tar -xzvf opensc-0.16.0.tar.gz
#  - pushd opensc-0.16.0 && ./bootstrap && ./configure --prefix=/usr --sysconfdir=/etc/opensc && make && sudo make install && popd
#  - sudo ldconfig
script:
  - dub test --compiler=$DC
#ls -la
#dub build --compiler=$DC --build=release
#sudo ldconfig
#sudo patch -u -b /etc/opensc/opensc.conf config/patchfile_travis.diff
#cat /etc/opensc/opensc.conf
#opensc-tool -D
#git clone https://github.com/OpenSC/OpenSC.git